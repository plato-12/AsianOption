---
title: "Practical Examples and Use Cases"
author: "Priyanshu Tiwari"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    css: dark-theme.css
vignette: >
  %\VignetteIndexEntry{Practical Examples and Use Cases}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)
library(AsianOption)
```

## Introduction

This vignette demonstrates practical applications of the `AsianOption` package
through detailed examples.

## Example 1: Basic Geometric Asian Option

Let's start with a simple at-the-money geometric Asian call option:

```{r}
# Standard parameters
S0 <- 100      # Initial stock price
K <- 100       # At-the-money strike
r <- 1.05      # 5% risk-free rate (gross)
u <- 1.2       # 20% up move
d <- 0.8       # 20% down move
lambda <- 0.1  # Price impact coefficient
v_u <- 1       # Unit hedging volume (up)
v_d <- 1       # Unit hedging volume (down)
n <- 5         # 5 time steps

price <- price_geometric_asian(S0, K, r, u, d, lambda, v_u, v_d, n)
cat("Geometric Asian call price:", round(price, 4), "\n")
```

## Example 2: Impact of Price Impact Parameter

Compare prices with varying $\lambda$ to see how price impact affects option value:

```{r}
lambdas <- seq(0, 0.3, by = 0.05)
prices <- sapply(lambdas, function(lam) {
  price_geometric_asian(100, 100, 1.05, 1.2, 0.8, lam, 1, 1, 5)
})

plot(lambdas, prices, type = "b",
     xlab = expression(lambda~" (Price Impact)"),
     ylab = "Option Price",
     main = "Effect of Price Impact on Geometric Asian Option",
     col = "blue", pch = 19, lwd = 2)
grid()
```

**Interpretation**: Higher price impact increases option value because hedging
amplifies price movements, effectively increasing volatility.

## Example 3: Strike Price Sensitivity

Examine how option value changes with strike price:

```{r}
strikes <- seq(80, 120, by = 5)
prices <- sapply(strikes, function(K) {
  price_geometric_asian(100, K, 1.05, 1.2, 0.8, 0.1, 1, 1, 5)
})

plot(strikes, prices, type = "b",
     xlab = "Strike Price K",
     ylab = "Option Price",
     main = "Geometric Asian Option Prices vs Strike",
     col = "darkgreen", pch = 19, lwd = 2)
abline(v = 100, lty = 2, col = "gray")
text(100, max(prices) * 0.9, "ATM", pos = 4)
grid()
```

## Example 4: Call vs Put Options

Compare call and put prices for the same parameters:

```{r}
# Call option
call_price <- price_geometric_asian(
  S0 = 100, K = 100, r = 1.05, u = 1.2, d = 0.8,
  lambda = 0.1, v_u = 1, v_d = 1, n = 5,
  option_type = "call"
)

# Put option
put_price <- price_geometric_asian(
  S0 = 100, K = 100, r = 1.05, u = 1.2, d = 0.8,
  lambda = 0.1, v_u = 1, v_d = 1, n = 5,
  option_type = "put"
)

cat("Call price:", round(call_price, 4), "\n")
cat("Put price:", round(put_price, 4), "\n")
cat("Call - Put:", round(call_price - put_price, 4), "\n")
```

## Example 5: Arithmetic Asian Bounds

For arithmetic Asian options, we can compute rigorous bounds:

```{r}
bounds <- arithmetic_asian_bounds(100, 100, 1.05, 1.2, 0.8, 0.1, 1, 1, 5)

cat("Arithmetic Asian Option Bounds:\n")
cat("  Lower (geometric price):", round(bounds$lower_bound, 4), "\n")
cat("  Upper (global):", round(bounds$upper_bound_global, 4), "\n")
cat("  Midpoint estimate:", round(mean(c(bounds$lower_bound, bounds$upper_bound_global)), 4), "\n")
```

### Tighter Path-Specific Bounds

```{r}
bounds_ps <- arithmetic_asian_bounds(
  S0 = 100, K = 100, r = 1.05, u = 1.2, d = 0.8,
  lambda = 0.1, v_u = 1, v_d = 1, n = 5,
  compute_path_specific = TRUE
)

print(bounds_ps)

cat("\nBound tightness:\n")
cat("  Global spread:", round(bounds_ps$upper_bound_global - bounds_ps$lower_bound, 2), "\n")
cat("  Path-specific spread:", round(bounds_ps$upper_bound_path_specific - bounds_ps$lower_bound, 2), "\n")
cat("  Improvement:",
    round((bounds_ps$upper_bound_global - bounds_ps$upper_bound_path_specific), 2), "\n")
```

**Observation**: The path-specific bound is much tighter than the global bound,
providing a better estimate of the true arithmetic Asian option price.

## Example 6: Comparison With and Without Price Impact

Compare option values with and without price impact:

```{r}
n_range <- 1:10

prices_no_impact <- sapply(n_range, function(n) {
  price_geometric_asian(100, 100, 1.05, 1.2, 0.8, 0, 0, 0, n)
})

prices_with_impact <- sapply(n_range, function(n) {
  price_geometric_asian(100, 100, 1.05, 1.2, 0.8, 0.1, 1, 1, n)
})

plot(n_range, prices_with_impact, type = "b", col = "blue", pch = 19, lwd = 2,
     xlab = "Time Steps (n)", ylab = "Option Price",
     main = "Impact of Price Impact on Option Value",
     ylim = range(c(prices_no_impact, prices_with_impact)))
lines(n_range, prices_no_impact, type = "b", col = "red", pch = 17, lwd = 2)
legend("topright",
       legend = c("With price impact (λ=0.1)", "No price impact (λ=0)"),
       col = c("blue", "red"), pch = c(19, 17), lty = 1, lwd = 2)
grid()
```

## Example 7: Risk-Neutral Probability Analysis

Examine how price impact affects the risk-neutral probability:

```{r}
# Compute adjusted factors
factors <- compute_adjusted_factors(u = 1.2, d = 0.8, lambda = 0.1, v_u = 1, v_d = 1)
p_adj <- compute_p_adj(r = 1.05, u = 1.2, d = 0.8, lambda = 0.1, v_u = 1, v_d = 1)

# Compare with no impact
p_standard <- compute_p_adj(r = 1.05, u = 1.2, d = 0.8, lambda = 0, v_u = 0, v_d = 0)

cat("Standard CRR factors:\n")
cat("  u =", 1.2, ", d =", 0.8, "\n")
cat("  p =", round(p_standard, 4), "\n\n")

cat("Adjusted factors (with impact):\n")
cat("  u_tilde =", round(factors$u_tilde, 4), "\n")
cat("  d_tilde =", round(factors$d_tilde, 4), "\n")
cat("  p_adj =", round(p_adj, 4), "\n\n")

# Verify no-arbitrage
cat("No-arbitrage check:\n")
cat("  d_tilde < r < u_tilde:",
    factors$d_tilde, "<", 1.05, "<", factors$u_tilde, "\n")
cat("  Valid:", check_no_arbitrage(1.05, 1.2, 0.8, 0.1, 1, 1), "\n")
```

## Example 8: Hedging Volume Sensitivity

Study the effect of different hedging volumes:

```{r}
v_range <- seq(0, 2, by = 0.2)

prices <- sapply(v_range, function(v) {
  price_geometric_asian(100, 100, 1.05, 1.2, 0.8, 0.1, v, v, 5)
})

plot(v_range, prices, type = "b",
     xlab = "Hedging Volume (v_u = v_d)",
     ylab = "Option Price",
     main = "Effect of Hedging Volume",
     col = "purple", pch = 19, lwd = 2)
grid()
```

## Example 9: Asymmetric Hedging Volumes

Explore the effect of asymmetric up and down hedging volumes:

```{r}
v_u_vals <- seq(0, 2, by = 0.2)

# Case 1: Vary v_u, fix v_d = 0.5
prices_var_u <- sapply(v_u_vals, function(v_u) {
  price_geometric_asian(100, 100, 1.05, 1.2, 0.8, 0.1, v_u, 0.5, 5)
})

# Case 2: Symmetric volumes
prices_symmetric <- sapply(v_u_vals, function(v) {
  price_geometric_asian(100, 100, 1.05, 1.2, 0.8, 0.1, v, v, 5)
})

plot(v_u_vals, prices_symmetric, type = "b", col = "blue", pch = 19, lwd = 2,
     xlab = "Hedging Volume", ylab = "Option Price",
     main = "Symmetric vs Asymmetric Hedging",
     ylim = range(c(prices_symmetric, prices_var_u)))
lines(v_u_vals, prices_var_u, type = "b", col = "red", pch = 17, lwd = 2)
legend("topleft",
       legend = c("Symmetric (v_u = v_d)", "Asymmetric (v_d = 0.5)"),
       col = c("blue", "red"), pch = c(19, 17), lty = 1, lwd = 2)
grid()
```

## Example 10: Moneyness Analysis

Examine option prices across different levels of moneyness:

```{r}
# Define moneyness: K/S0
moneyness <- seq(0.7, 1.3, by = 0.05)
strikes <- moneyness * 100

prices <- sapply(strikes, function(K) {
  price_geometric_asian(100, K, 1.05, 1.2, 0.8, 0.1, 1, 1, 5)
})

plot(moneyness, prices, type = "b",
     xlab = "Moneyness (K/S0)",
     ylab = "Option Price",
     main = "Option Price vs Moneyness",
     col = "darkred", pch = 19, lwd = 2)
abline(v = 1, lty = 2, col = "gray")
text(1, max(prices) * 0.8, "ATM", pos = 4)
grid()
```

## Example 11: European vs Asian Options

Compare European and Asian options under the same conditions:

```{r}
n_vals <- seq(5, 15, by = 2)

# European options (path-independent)
euro_prices <- sapply(n_vals, function(n) {
  price_european_call(100, 100, 1.05, 1.2, 0.8, 0.1, 1, 1, n)
})

# Asian options (path-dependent)
asian_prices <- sapply(n_vals, function(n) {
  price_geometric_asian(100, 100, 1.05, 1.2, 0.8, 0.1, 1, 1, n)
})

plot(n_vals, euro_prices, type = "b", col = "blue", pch = 19, lwd = 2,
     xlab = "Time Steps (n)", ylab = "Option Price",
     main = "European vs Asian Options",
     ylim = range(c(euro_prices, asian_prices)))
lines(n_vals, asian_prices, type = "b", col = "orange", pch = 17, lwd = 2)
legend("topright",
       legend = c("European Call", "Geometric Asian Call"),
       col = c("blue", "orange"), pch = c(19, 17), lty = 1, lwd = 2)
grid()

cat("\nAt n=10:\n")
cat("  European:", round(euro_prices[which(n_vals == 11)], 2), "\n")
cat("  Asian:", round(asian_prices[which(n_vals == 11)], 2), "\n")
```

**Observation**: European options are typically worth more than Asian options
because they depend only on the (potentially more extreme) terminal price,
while Asian options average over the entire path.

## Example 12: Convergence Analysis

Study how geometric Asian option prices converge as $n$ increases:

```{r}
n_seq <- c(2, 3, 5, 7, 10, 12, 15)
prices <- numeric(length(n_seq))

for (i in seq_along(n_seq)) {
  n <- n_seq[i]
  prices[i] <- price_geometric_asian(
    100, 100, 1.05, 1.2, 0.8, 0.1, 1, 1, n
  )
}

plot(n_seq, prices, type = "b", pch = 19, col = "darkblue", lwd = 2,
     xlab = "Number of Time Steps (n)",
     ylab = "Option Price",
     main = "Price Convergence with Increasing n (Exact Enumeration)")
grid()

# Show the prices
result_df <- data.frame(
  n = n_seq,
  Paths = 2^n_seq,
  Price = round(prices, 4)
)
print(result_df)
```

**Note**: All these prices are exact—computed via complete enumeration of
all $2^n$ paths.

## Example 13: Bound Spread Analysis

Analyze how the spread of arithmetic Asian bounds changes with $n$:

```{r}
n_values <- 2:8
global_spreads <- numeric(length(n_values))
ps_spreads <- numeric(length(n_values))

for (i in seq_along(n_values)) {
  n <- n_values[i]
  bounds <- arithmetic_asian_bounds(100, 100, 1.05, 1.2, 0.8, 0.1, 1, 1, n,
                                     compute_path_specific = TRUE)
  global_spreads[i] <- bounds$upper_bound_global - bounds$lower_bound
  ps_spreads[i] <- bounds$upper_bound_path_specific - bounds$lower_bound
}

plot(n_values, global_spreads, type = "b", col = "red", pch = 19, lwd = 2,
     xlab = "Number of Time Steps (n)",
     ylab = "Bound Spread",
     main = "Arithmetic Asian Bound Spreads vs n",
     log = "y", ylim = range(c(global_spreads, ps_spreads)))
lines(n_values, ps_spreads, type = "b", col = "blue", pch = 17, lwd = 2)
legend("topleft",
       legend = c("Global Bound", "Path-Specific Bound"),
       col = c("red", "blue"), pch = c(19, 17), lty = 1, lwd = 2)
grid()
```

**Observation**: Both bound spreads increase with $n$, but the path-specific
bound remains much tighter than the global bound.

## Example 14: Multiple Price Impact Scenarios

Compare geometric Asian option prices under different price impact regimes:

```{r}
# Define scenarios
scenarios <- list(
  "No Impact" = list(lambda = 0, v_u = 0, v_d = 0),
  "Low Impact" = list(lambda = 0.05, v_u = 1, v_d = 1),
  "Medium Impact" = list(lambda = 0.1, v_u = 1, v_d = 1),
  "High Impact" = list(lambda = 0.2, v_u = 1, v_d = 1),
  "Asymmetric" = list(lambda = 0.1, v_u = 1.5, v_d = 0.5)
)

n_vals <- 3:10
results <- matrix(NA, nrow = length(n_vals), ncol = length(scenarios))
colnames(results) <- names(scenarios)
rownames(results) <- paste0("n=", n_vals)

for (j in seq_along(scenarios)) {
  sc <- scenarios[[j]]
  for (i in seq_along(n_vals)) {
    results[i, j] <- price_geometric_asian(
      100, 100, 1.05, 1.2, 0.8, sc$lambda, sc$v_u, sc$v_d, n_vals[i]
    )
  }
}

print(round(results, 2))
```


